<!DOCTYPE HTML>
<html>

<head>
  <meta charset="UTF-8">
  <title>ElmTests</title>
  <script type="text/javascript" src="elm.js"></script>
  <script type="text/javascript" src="pouchdb-3.2.1.min.js"></script>
  <script type="text/javascript" src="underscore-min.js"></script>
  <!--link rel="stylesheet" href="style.css"-->
</head>

<body>
</body>

<script type="text/javascript">
var db = new PouchDB('elm-todo-state');
var initialState;
var todomvc;

db.get('storedState')
    .then( function (state){ todomvc = Elm.fullscreen(Elm.Todo, { getStorage: state }); }
         , function () { todomvc = Elm.fullscreen(Elm.Todo, { getStorage: null }); }
         )
    .then( function(){
        todomvc.ports.setStorage.subscribe(function(signalState) {
          db.get('storedState').then(function(storedState){
            signalState._id = storedState._id;
            signalState._rev = storedState._rev;

            signalState.field = "";
            storedState.field = "";

            if (!_.isEqual(signalState, storedState)) {              
              db.put(signalState);
            }

          });
        });
    });


</script>

</html>
